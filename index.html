<!doctype html>
<html>
	<img src="images/Hook42Logo.png" style="margin: 2rem; height: 7%; position: absolute;" />
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Custom Modules</title>

		<link rel="stylesheet" href="css/reveal.css">
		<link rel="stylesheet" href="css/theme/hook42.css">

		<!-- Theme used for syntax highlighting of code -->
		<link rel="stylesheet" href="lib/css/zenburn.css">

		<!-- Printing and PDF exports -->
		<script>
			var link = document.createElement( 'link' );
			link.rel = 'stylesheet';
			link.type = 'text/css';
			link.href = window.location.search.match( /print-pdf/gi ) ? 'css/print/pdf.css' : 'css/print/paper.css';
			document.getElementsByTagName( 'head' )[0].appendChild( link );
		</script>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				<section class="present" style="top: 226px; display: block;">
					<h1 class="text__dark text__bold">
						Drupal 8 Custom Module Architecture </h1>
						<h3>Whatâ€™s Going On? </h3>
					<p>Lindsay Gaudinier at Hook 42</p>
				</section>

				<section>
					<h3>About me</h3>
					<ul>
						<li class="fragment">Developer at Hook 42</li>
						<li class="fragment">Swimming, cats, and the internet</li>
					</ul>
					<div>
						<img src="images/dude.png" class="fragment" style="width: 250px;">
					</div>

				</section>

				<section>
					<h3>The Thought Behind the Talk</h3>
					<span class="font-25">
						<p class="fragment"> I had to create a custom module for the first time, and I had only modified code in the past</p>
						<div class="fragment ol-image">
							<img src="images/noideawhatsgoingon.gif" />
						</div>
						<p class="fragment">I didn't want to just know how to make a custom module, I wanted to know the answers to all my why questions</p>
					</span>
				</section>

				<section>
					<h3>Quick note: sometimes words are mentioned before they are defined. Please have patience.</h3>
				</section>

				<section>
					<h3>We can't just start with the list of files</h3>
					<span class="fragment">
						<p>Nothing is ever that easy.</p>
						<img src="images/crying.gif" />
					</span>
				</section>

				<section>
					<h3>PSR-4: Improved Autoloading</h3>
					<ul class="font-25">
						<li class="fragment">PSR stands for PHP Standard Recommendation</li>
						<li class="fragment">PSR is a PHP specification that is published by the <a href="https://www.php-fig.org/">PHP Framework Interop Group (php-fig)</a> who's focus is to move "PHP foward through collaboration and standards"</li>
						<li class="fragment">Drupal 8 implements the PSR-4 standard for namespaces and autoloading</li>
						<li class="fragment"><a href="https://www.php-fig.org/psr/psr-4/">PSR-4</a>: "Autoloaders remove the complexity of including files by mapping namespaces to file system paths."</li>
					</ul>
					<img class="fragment" src="images/confused.gif" />
				</section>

				<section>
					<h3>Autoloading</h3>
					<ul>
						<li class="fragment">Autoloading is capability of loading and linking portions of a program automatically when needed. The autoloader searches through a path of directories and finds the code that defines the subroutine (method/function).</li>
						<li class="fragment">Autoloading means your code does not need to include a long list of source files in your php file</li>
						<li class="fragment">The magic of autoloading works because of namespacing</li>
					</ul>
				</section>

				<section>
					<h3>Namespacing</h3>
					<ul>
						<li class="fragment">"Namespaces are commonly structured as hierarchies to allow reuse of names in different contexts." - <a href="https://en.wikipedia.org/wiki/Namespace">Wikipedia</a></li>
						<li class="fragment">Namespacing helps you avoid name collisions if you repeat the name for a function/class that was declared before</li>
						<li class="fragment">Eliminates need for super long class names, points to where in the code you can find the function source</li>
					</ul>
				</section>

				<section>
					<h3>Namespacing: Code Examples</h3>
					https://www.php-fig.org/psr/psr-4/
				</section>

				<section>
					<h3> Symfony</h3>
					<ul>
						<li>Symfony is a PHP framework and a set of reuasable PHP components and libraries</li>
						<li>Defined as a MVC (Model, View, and Controller) framework</li>
						<li>Components are standalone PHP libraries that generate specific features</li>
					</ul>
				</section>

				<section>
					<h3>Some Symfony Components</h3>
					<ul class="font-20">
						<li><strong>ClassLoader:</strong> provides tools to autoload classes and cache their locations for performance</li>
						<li><strong>Console:</strong> helps you create command line interfaces</li>
						<li><strong>CssSelector:</strong> converts CSS selectors to XPath (XML Path language) expression</li>
						<li><strong>DependencyInjection:</strong> lets you standardize and centralize the way objects are constructed</li>
						<li><strong>EventDispatcher:</strong> lets components communicate with each other</li>
						<li><strong>HttpFoundation:</strong> defined an object-oriented layer for the HTTP specification</li>
						<li><strong>HttpKernel:</strong> converts a HTTP Request into a HTTP Respose by using a EventDispatcher component</li>
						<li><strong>Process:</strong> executes commands in subprocesses, creates APi for shell executions https://symfony.com/doc/current/components/process.html</li>
						<li><strong>Routing:</strong> maps an HTTP request to a set of configurable variables</li>
						<li><strong>Serializer:</strong> turn objects into specific formats (YAML) and specific formats into objects</li>
						<li><strong>Translation:</strong> provides tools for internationalization</li>
						<li><strong>Validator:</strong> validates following <a href="https://jcp.org/en/jsr/detail?id=303">JSR 303: Bean Validation</a></li>
						<li><strong>Yaml:</strong> parses YAML strings to conver them to PHP arrays, and vice versa</li>
					</ul>
				</section>


				<section>
					<h3>Why are you telling me this?</h3>
					<img src="images/why.gif" />
					<ul class="font-25">
						<li class="fragment">
							Autoloading and namespacing play an important role in how and why we structure files and code in a module
						</li>
						<li class="fragment">
							While Drupal 8 does NOT use the Symfony framework, D8 uses some Symfony components: ClassLoader, DependencyInjection, EventDispatcher, HTTPFoundation, HTTPKernel, Routing, Serializer, Validator, YAML
						</li>
					</ul>

				</section>

				<section>
					<h3>Types of files:</h3>
					<ul>
						<li class="fragment">YAML (YAML Ain't Markup Language): .yml, .yaml</li>
						<li class="fragment">PHP: Hypertext Preprocessor: .php </li>
						<li class="fragment">Markdown: .md</li>
						<li class="fragment">Javascript Object Notation (JSON): .json</li>
						<li class="fragment"> Module: .module</li>
						<li class="fragment">inc: Included file, is not a stand alone file [this needs more clarification]</li>
						<li class="fragment"> Javascript: .js	</li>
						<li class="fragment"> CSS (Cascading Style Sheets): .css</li>
					</ul>
				</section>

				<section>
					<h3>Naming the module</h3>
					<ul>
						<li class="fragment">Start with a letter</li>
						<li class="fragment">Contain only lower-case letters and underscores</li>
						<li class="fragment">No spaces</li>
						<li class="fragment">Unique name</li>
						<li class="fragment">Does not contain any reserved words: src, lib, vendor, assets, css, files, images, js, misc, templates, includes, fixtures, Drupal</li>
					</ul>
				</section>

				<section>
					<h3>The Module Skeleton</h3>
					<img src="images/skeleton.gif" style="width: 400px;"/>
				</section>

				<section>
					<h3>Capable Module</h3>
					<div class="module-files">
<pre class="font-10">
modules
	/contrib
	/custom
		/capable
			.estlintrc
			README.md
			STANDARDS.md
			TESTING.md
			capable.api.php
			capable.data.inc
			capable.info.yml
			capable.libraries.yml
			capable.links.menu.yml
			capable.module
			capable.permissions.yml
			capable.routing.yml
			capable.services.yml
			capable.task.yml
			composer.json
			/config
				/install
					capable.settings.yml
				/schema
					capable.schema.yml
			/css
				main.css
			drupalci.yml
			/js
				main.js
			/src
				/Controller
					CapableController.php
				/Entity
					Robot.php
				/Form
					SignUpForm.php (might need to fix this)
				/Plugin
					[need to find an example plugin]
			/templates
				homepage.html.twig
			/tests
</pre>
					</div>
				</section>

				<section>
					<h3>capable.info.yml</h3>
					<ul>
						<li class="fragment">The info.yml file lives in your root folder and tells Drupal about your module</li>
						<li class="fragment">The info.yml file information can be found on the Drupal admin pages (/admin/modules)</li>
						<li class="fragment">Technically, the only required file in your module (although the module won't do anything)</li>
					</ul>
					<img class="fragment" src="images/capable-module-info-file.png" />
				</section>

				<section>
					<h3>What's going on?</h3>
					<div class="left-40">
						<img src="images/capable-module-info-file.png"/>
					</div>
					<div class="right-60">
						<img src="images/capable-module-info-screenshot.png"/>
					</div>
				</section>

				<section>
					<h3>capable.info.yml complete example</h3>
					<div class="left">
						<img src="images/capable-module-info-file-2.png" class="fragment" />
					</div>
					<div class="right font-16">
						<ul>
							<li class="fragment">
								depedencies: <br />
								<ul>
									<li>List the other module(s) that your module depends on to work.</li>
									<li>Namespacing: {project}:{module}</li>
									<li>{project} is the name as it appears in the Drupal.org url (https://www.drupal.org/project/token)</li>
									<li>{module} is the module machine name (token)</li>
									<li>Can also include version restrictions: token:token (8.x-1.3)</li>
								</ul>
							</li>
							<li class="fragment">
								test_dependencies:
								<ul>
									<li>List the module(s) you need to run automated tests</li>
									<li>Same namespacing as dependecies: {project}:{module} </li>
								</ul>
							</li>
							<li class="fragment">
								configure:
								<ul>
									<li>Specify the route to a configuration form</li>
									<li>This will show on the /admin/modules pages when you expand [this needs different words or an image]</li>
								</ul>
							</li>
							<li class="fragment">
								php:
								<ul>
									<li>Defines the <strong>minimum</strong> PHP verison that your module requires</li>
									<li>Can't enable the module if your PHP version is older</li>
								</ul>
							</li>
							<li class="fragment">
								hidden:
								<ul>
									<li>hidden: true, will hide your your module on the /admin/modules page</li>
									<li>Why would you hide your module? Perhaps it only implements tests and you don't want it disabled</li>
								</ul>
							</li>
						</ul>
					</div>
				</section>

				<section>
					<h3>The Controller File</h3>
					<ul class="font-25">
						<li class="fragment">Following PSR-4, the controller file will live inside a folder called src, and then in a folder called Controller</li>
						<li class="fragment">src stands for source</li>
						<img src="images/source-folder.png" class="fragment" />
						<li class="fragment">Need to declare a namespace at the top.</li>
						<li class="fragment">Namespace format: Drupal\[module name]\Controller;</li>
						<li class="fragment">The controller file will work with the router file</li>
					</ul>
				</section>

				<section>
					<h3>CapableController.php</h3>
					<img src="images/capable-controller-file.png" class="left-40"/>
					<ul class="right-60 font-20">
						<li class="fragment">
							<strong>namespace Drupal\capable\Controller:</strong> declaring the namespace for the capable Controller class <br />
							- this must be done before any other code (except a declare statement)
						</li>
						<li class="fragment">
							<strong>use Drupal\Core\Controller\ControllerBase: </strong> importing (aliasing) the Drupal core ControllerBase, which is being extended by CapableController class. <br />
							- Do not include a leading \ <br />
							- Only specify one class per use statement. <br />
							- No clear rule to order for multiple use statements. <br />
							- Final use statement should habe a blank line underneath it.
						</li>
						<li class="fragment">
							<strong>class CapableController extends ControllerBase:</strong> creation of CapableController class that extends Drupal's core ControllerBase class
						</li>
						<li class="fragment">
							<strong>public function content():</strong> take note of the name of the function, this will come back in the routing file
						</li>
					</ul>
				</section>

				<section>
					<h3>The Routing File</h3>
					<ul class="font-25">
						<li class="fragment">A route is a path where Drupal returns some sort of content</li>
						<li class="fragment">The router determines which code should be run to generate the response.	</li>
						<li class="fragment">The routing system is responsible for matching paths to controllers.</li>
						<img src="images/capable-module-routing-file.png" class="fragment" />
					</ul>
				</section>

				<section>
					<h3>capable.routing.yml</h3>
					<img src="images/routing-file-simple.png" />
				</section>

				<section>
					<h3>Routing + Controller Working Together</h3>
					<img src="images/routing-file-simple-outlined.png" style="height: 130px;"/>
					<img src="images/capable-controller-file-outlined.png" style="height: 225px;"/>
					<img src="images/routing-file-screenshot.png" style="height: 275px;" />
				</section>

				<section>
					<h3>Routing + Controller Working Together</h3>
					<img src="images/d8-routing.png" />
				</section>

				<section>
					<h3>Parameters in Routes</h3>
					<ul class='font-20'>
						<li class="fragment">Parameters are used for URLs that may contain dynamic values. <br />
							/parameters/{partial} would work for both /parameters/hello and /parameters/goodbye </li>
						<li class="fragment"> The {partial} element in the url is called a slug, and is is avaible as a $partial in the controller method</li>
						<li class="fragment">You can even have multiple parameters on a single route: product/{product#}/{color}</li>
						<div class="fragment">
							<img src="images/router-parameters.png" class="left"/>
							<img src="images/controller-parameters.png" class="right"/>
						</div>
					</ul>
				</section>

				<section>
					<h3>Parameters in Routes</h3>
					<img src="images/parameters-hello.png" style="width: 600px;"/>
					<img src="images/parameters-goodbye.png" style="width: 600px;" />
				</section>

				<section>
					<h3>Dynamic Routes</h3>
					https://www.drupal.org/node/2122201 <br />
					https://www.drupal.org/docs/8/api/routing-system/altering-existing-routes-and-adding-new-routes-based-on-dynamic-ones
				</section>

				<section>
					<h3>Access checking on routes</h3>
					https://www.drupal.org/docs/8/api/routing-system/access-checking-on-routes
				</section>

				<section>
					<h3>All the capable.routing.yml properties </h3>
					<img src="images/standin-routing.png" class="left"/>
					<div class="right font-10">
						<ul>
							<li><strong>path:</strong> Required, must begin with a forward slash (/), first item of the path must NOT be dynamic</li>
							<li><strong>defaults:</strong> Requied, defines the default properties of a route.
								<ul>
									<li>
										<strong>_controller:</strong> A callable value that returns:
										<ul>
											<li>
												a renderable array, rendered into HTML and used as the content of a normal Drupal page
											</li>
											<li>
												an Symfony\Component\HttpFoundation\Response object, example for a non-HTML XML feed
											</li>
											<li>
												namespace: \Drupal\[module name]\Controller\[ClassName]::[method]
											</li>
											<li>
												path: [module name]/src/Controller/[ClassName].php that contains a build() method
											</li>
											<li>
												service: controller.test[method], where controller.test is a service definedint he dependency injection container // THIS NEEDS AN EXPLANATION
											</li>
										</ul>
									</li>
									<li><strong>_form:</strong></li>
									<li><strong>_entity_view:</strong></li>
									<li><strong>_entity_list:</strong></li>
									<li><strong>_entity_form:</strong></li>
									<li><strong>_title:</strong></li>
									<li><strong>_title_arguments:</strong></li>
									<li><strong>_title_context:</strong></li>
								</ul>
							</li>
							<li><strong>methods: </strong>Optional, match the method of the incoming request. Should be enclosed in brackets, and separated by commas</li>
							<li><strong>requirements:</strong></li>
							<ul>
								<li><strong>_permission: </strong></li>
								<li><strong>_role: </strong></li>
								<li><strong>_access: </strong></li>
								<li><strong>_entity_access: </strong></li>
								<li><strong>_custom_access: </strong></li>
								<li><strong>_format: </strong></li>
								<li><strong>_content_type_format: </strong></li>
								<li><strong>_module_dependencies: </strong></li>
								<li><strong>_csrf_token: </strong></li>
							</ul>
							<li><strong>options:</strong></li>
							<ul>
								<li><strong>_admin_route: </strong></li>
								<li><strong>_auth: </strong></li>
								<li><strong>_theme: </strong></li>
								<li><strong>no_cache</strong></li>
								<li><strong>parameters</strong></li>
							</ul>
						</ul>
					</div>
				</section>

				<section>
					<h3>Module Menu Link</h3>
					<p class="font-16">Menu link to the module in the Development section of the Administration >> Configuration (/admin/config)</p>
					<img src="images/capable-module-links-file.png" />
				</section>

				<section>
					<h3>Module Menu Link</h3>
					<img src="images/capable-module-links-menu.png" />
					<img src="images/capable-module-links-routing.png" class="left"/>
					<img src="images/capable-module-menu-controller.png" class="right"/>
				</section>

				<section>
					<h3>Module Menu Link Screenshot</h3>
					<img src="images/capable-module-menu-links-screenshot.png" style="height: 500px;"/>
				</section>

				<section>
					<h3>Module Menu Link Flexibility</h3>
					<p>You can also set the [module].links.menu.yml to link to external links or to an internal path</p>
					<div class="left font-20">
						External Link
						<img src="images/capable-module-menu-links-external.png" />
					</div>
					<div class="right font-20">
						Internal Link
						<img src="images/capable-module-menu-links-internal.png"/>
					</div>
				</section>

				<section>
					<h3>capable.module</h3>
					apparently this is a optional file? <br />
					http://befused.com/drupal/first-drupal8-module
				</section>

				<section>
					<h3>Introduction to Hooks</h3>
				</section>

				<section>
					<h3>composer.json</h3>
				</section>

				<section>
					<h3>Forms</h3>
					https://www.drupal.org/docs/8/api/form-api/introduction-to-form-api
				</section>

				<section>
					<h3>Config</h3>
						settings.yml <br />
						schema.yml
				</section>

				<section>
					<h3>Permissions</h3>
				</section>

				<section>
					<h3>Libraries</h3>
				</section>

				<section>
					<h3>Services</h3>
				</section>

				<section>
					<h3>Module Themeing</h3>
				</section>

				<section>
					<h3>Javascript</h3>
				</section>

				<section>
					<h3>CSS</h3>
				</section>

				<section>
					<h3>Twig Templates</h3>
				</section>

				<section>
					<h3>Tests</h3>
				</section>

				<section>
					<h2>All The Sources</h2>
					<img src="images/read-all-the-things.png" />
				</section>

				<section>
					<div class="font-10">
						<h3>Namespaces</h3>
						<ul>
							<li><a href="https://www.sitepoint.com/php-53-namespaces-basics/">https://www.sitepoint.com/php-53-namespaces-basics/</a></li>
							<li><a href="https://www.drupal.org/docs/develop/coding-standards/namespaces">https://www.drupal.org/docs/develop/coding-standards/namespaces</a></li>
							<li>
								<a href="https://en.wikipedia.org/wiki/Namespace">https://en.wikipedia.org/wiki/Namespace</a>
							</li>
							<li>
								<a href="https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-4-autoloader-examples.md">https://github.com/php-fig/fig-standards/blob/master/accepted/PSR-4-autoloader-examples.md</a>
							</li>
						</ul>
					</div>
					<div class="font-10">
						<h3>General</h3>
						<ul>
							<li>
								https://www.drupal.org/docs/8/creating-custom-modules/a-practical-guide-to-building-basic-drupal-8-modules
							</li>
						</ul>
					</div>
					<div class="font-10">
						<h3>Symfony</h3>
						<ul>
							<li>
								<a href="https://symfony.com/doc/current/controller.html">https://symfony.com/doc/current/controller.html</a>
							</li>
							<li>
								<a href="https://symfony.com/doc/current/components/http_kernel.html">https://symfony.com/doc/current/components/http_kernel.html</a>
							</li>
							<li>
								<a href="https://symfony.com/doc/current/components/yaml.html">https://symfony.com/doc/current/components/yaml.html</a>
							</li>
						</ul>
					</div>
					<div class="font-10">
						<h3>Routing</h3>
						<ul>
							<li>
								<a href="https://www.drupal.org/node/2116767">https://www.drupal.org/node/2116767</a>
							</li>
							<li>
								<a href="https://www.drupal.org/docs/8/api/routing-system/structure-of-routes">https://www.drupal.org/docs/8/api/routing-system/structure-of-routes</a>

							</li>
						</ul>
					</div>
					<div class="font-10">
						<h3>Example Modules:</h3>
						<ul>
							<li>
								http://cgit.drupalcode.org/examples/tree/?h=8.x-1.x
							</li>
						</ul>
					</div>
				</section>
				<section>
					<h3>Questions?</h3>
					<img src="images/questions.gif" style="width: 500px;">
				</section>

			</div>
		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.js"></script>

		<script>
			// More info https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				history: true,
				slideNumber: true,

				// More info https://github.com/hakimel/reveal.js#dependencies
				dependencies: [
					{ src: 'plugin/markdown/marked.js' },
					{ src: 'plugin/markdown/markdown.js' },
					{ src: 'plugin/notes/notes.js', async: true },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
				]
			});
		</script>
	</body>
</html>
